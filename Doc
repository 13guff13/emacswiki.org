








== ビルドツールの導入 ==

<pre>
sudo apt-get install --assume-yes autoconf automake bison build-essential flex gawk gcc gettext git gperf libexpat1-dev libtool ncurses-dev texinfo curl zlib1g-dev
# submodule対応git-new-workdirの導入
pushd /tmp
git clone https://github.com/eacousineau/util.git
cd util
sudo ./install /usr/local/bin
popd
</pre>

== <tt>ct-ng</tt> の導入 ==

<pre>
mkdir -p ${CT_TOP_DIR}/tools 
mkdir -p ${CT_TOP_DIR}/tarballs
cp /home/onohr/proj_gnutools-rx/GNUTOOLS_RX_DEV/tarballs/* ${CT_TOP_DIR}/tarballs/
tar x -C ${CT_TOP_DIR}/tools --bzip2 -f ${CT_TOP_DIR}/tarballs/ctng_for_rx_130919.tar.bz2
cd crosstool-ng
./bootstrap
./configure --prefix=/some/place
make
make install
export PATH="${PATH}:/some/place/bin"
</pre>


usage
ex) ct-ng help
ex) ct-ng menuconfig
ex) ct-ng build


=== ct-ng で使う環境変数 ===


Environment variables (see /home/onohr/share/doc/crosstool-ng/ct-ng.hg+unknown-20130918.164153/0 - Table of content.txt):
STOP=step          - Stop the build just after this step (list with list-steps)
RESTART=step       - Restart the build just before this step (list with list-steps)
CT_PREFIX=dir      - install samples in dir (see action "build-all", above).
V<tt>012              - 0 </tt>> show only human-readable messages (default)
1 => show only the commands being executed
2 => show both


== GCC 等は以下のようにしてソースを導入 ==

<pre>
cd ${CT_TOP_DIR}/custom_component
git clone git://cpusys.mu.renesas.com/rx/rx_toolchain/binutils-2.22_rx_sh_h8_v12.01.git binutils
git clone git://cpusys.mu.renesas.com/rx/rx_toolchain/gcc-4.6.2_rx_sh_h8_v12.01.git gcc
git clone git://cpusys.mu.renesas.com/rx/rx_toolchain/elf2flt-cvs-head.git elf2flt
</pre>

== Linux kernel 等は以下の様にして導入 ==

<pre>
cd ${UCLINUXDIST_DIR}
git clone pcepx20:/project/rx-linux/git/uClinux-dist-rx.git takata_uClinux-dist-rx
pushd takata_uClinux-dist-rx/
git submodule update --init
pop

git new-workdir ${UCLINUXDIST_DIR}/takata_uClinux-dist-rx/uClibc ${CT_TOP_DIR}/custom_component/uClibc
# [ Old -> New ]
#         /work/proj_uClinux-dist/takata_uClinux-dist-rx/uClibc
#         /work/proj_gnutools-rx/GNUTOOLS_RX_DEV/custom_component/uClibc
#         [ Note ] Copying .git/config and unsetting core.worktree

git new-workdir ${UCLINUXDIST_DIR}/takata_uClinux-dist-rx/linux-rx-2.6.38 ${CT_TOP_DIR}/custom_component/linux
# [ Old -> New ]
#         /work/proj_uClinux-dist/takata_uClinux-dist-rx/linux-rx-2.6.38
#         /work/proj_gnutools-rx/GNUTOOLS_RX_DEV/custom_component/linux
#         [ Note ] Copying .git/config and unsetting core.worktree

</pre>

clone 直後だが念のため最新に更新

<pre>
${CT_TOP_DIR}/custom_component/linux $ git br
== (detached from 70e3378) ==
  master
${CT_TOP_DIR}/custom_component/linux $ git br -v
== (detached from 70e3378) 70e3378 RX: Remove __xg () and update __xchg () ==
  master                  4699813 Merge branch 'pic' into dev
${CT_TOP_DIR}/custom_component/linux $ git pull origin master
From pcepx20:/project/rx-linux/git/linux-rx
 * branch            master     -> FETCH_HEAD
Updating 70e3378..4699813
Fast-forward
 fs/binfmt_flat.c  4 ++++
 1 file changed, 4 insertions (+)
${CT_TOP_DIR}/custom_component/linux $ git br -v
== (detached from 70e3378) 4699813 Merge branch 'pic' into dev ==
  master                  4699813 Merge branch 'pic' into dev
${CT_TOP_DIR}/custom_component/linux $ git checkout master
Switched to branch 'master'
${CT_TOP_DIR}/custom_component/linux (master)$
${CT_TOP_DIR}/custom_component/linux $ cd ../uClibc/
${CT_TOP_DIR}/custom_component/uClibc $ git br -v
== (detached from 7e2dfb6) 7e2dfb6 rx: Don't include crt1.o into libc.a ==
  master                  7e2dfb6 rx: Don't include crt1.o into libc.a
${CT_TOP_DIR}/custom_component/uClibc $ git pull origin master
From pcepx20:/project/rx-linux/git/uClibc
 * branch            master     -> FETCH_HEAD
Already up-to-date.
${CT_TOP_DIR}/custom_component/uClibc $ git br -v
== (detached from 7e2dfb6) 7e2dfb6 rx: Don't include crt1.o into libc.a ==
  master                  7e2dfb6 rx: Don't include crt1.o into libc.a
${CT_TOP_DIR}/custom_component/uClibc $ git checkout master
Switched to branch 'master'
${CT_TOP_DIR}/custom_component/uClibc (master)$
</pre>

最終的に <tt>${CT_TOP_DIR}/custom_component</tt> 以下に <tt>{TOOL 名}</tt> の形でソー
スを展開しておけば <tt>ct-ng</tt> がそのまま扱ってくれるのでここで開発する

== <tt>ct-ng</tt> の実行 ==

本環境は 32bit システムでしかビルドを確認していないため 64bit システム上で
chroot を使い 32bit 環境を作り出している場合, ABI<>ISA となることがある. そ
の場合, <tt>ct-ng</tt> の起動には以下のおまじないが必要.

<pre>
setarch i686 ct-ng build
</pre>

cf) 『 タスク #1764: KPIT v12.01 ビルド方法 - KPIT v12.01
http://cpusys.mu.renesas.com/issues/1764#note-11 』

== Realese 版の作り方 ==

<tt>${CT_TOP_DIR}/custom_component</tt> 以下に git ディレクトリをそのまま持って
いたのでは HDD の容量を食い過ぎて不便である. そこで Release 版だけ
<tt>tar+bzip2</tt> にして HDD 容量を減らす工夫をする.

<pre>
mkdir -p ${RELEASE_VERSION_DIR}/tarballs
cd ${CT_TOP_DIR}/custom_component
pushd binutils
git archive --format<tt>tar --prefix</tt>binutils-custom/ 0.8 | bzip2 > ${RELEASE_VERSION_DIR}/tarballs/binutils-VERSION.tar.bz2
popd
pushd elf2flt
git archive --format<tt>tar --prefix</tt>elf2flt-custom/ 0.8 | bzip2 > ${RELEASE_VERSION_DIR}/tarballs/elf2flt-VERSION.tar.bz2
popd
pushd gcc
git archive --format<tt>tar --prefix</tt>gcc-custom/ 0.8 | bzip2 > ${RELEASE_VERSION_DIR}/tarballs/gcc-VERSION.tar.bz2
popd
cd ~/takata_uClinux-dist-rx
pushd linux-rx-2.6.38
git archive --format<tt>tar --prefix</tt>linux-custom/ master | bzip2 > ${RELEASE_VERSION_DIR}/tarballs/linux-VERSION.tar.bz2
popd
pushd uClibc
git archive --format<tt>tar --prefix</tt>uClibc-custom/ HEAD | bzip2 > ${RELEASE_VERSION_DIR}/tarballs/uCleibc-VERSION.tar.bz2
popd
</pre>

Realese 版の.config は <tt>pcepx20:/home/onohr/proj_gnutools-rx/GNUTOOLS_RX_RELESE08/rx-uclinux.config</tt> を参考に各自環境に合わせること

== ERROR 関連 ==

ct-ng を実行する環境依存の問題で以下のエラーで PPL 等が作れない時がある. そのような場合は static で libstd++ をリンクさせる


[ERROR]    ${CT_TOP_DIR}/.build/src/ppl-0.11.2/src/Variable.inlines.hh:43: undefined reference to `std::length_error::~length_error ()'
[ERROR]    make[2]: *** [cc1] Error 1
[ERROR]    make[2]: *** [lto1] Error 1
[ERROR]    make[1]: *** [all-gcc] Error 2


<pre>
diff -u .config.old .config
--- .config.old	2013-10-01 17:19:12.759174966 +0900
+++ .config	2013-10-01 18:27:22.861837457 +0900
 #
 CT_CONFIGURE_has_xz=y
 CT_MODULES=y
@@ -165,6 +165,7 @@
 CT_USE_SYSROOT=y
 CT_SYSROOT_NAME="sysroot"
 CT_SYSROOT_DIR_PREFIX=""
+CT_WANTS_STATIC_LINK=y
 # CT_STATIC_TOOLCHAIN is not set
 CT_TOOLCHAIN_PKGVERSION="cpusori-0.1"
 CT_TOOLCHAIN_BUGURL="http://cpusys.mu.renesas.com/users/3"
@@ -372,7 +373,7 @@
 CT_CC_ENABLE_CXX_FLAGS=""
 CT_CC_CORE_EXTRA_CONFIG_ARRAY<tt>"--enable-linker-build-id</tt>no"
 CT_CC_EXTRA_CONFIG_ARRAY=""
-# CT_CC_STATIC_LIBSTDCXX is not set
+CT_CC_STATIC_LIBSTDCXX=y
CT_CC_GCC_SYSTEM_ZLIB=y
</pre>


== COMMENT  ==

本 TEXT の HTML 化は以下

<pre>
emacs --batch --visit='README.txt' --funcall 'org-export-as-html-batch'
</pre>






This was generated with OrgReadme.  On updating the library, this page is likely to be replaced with updated content.
