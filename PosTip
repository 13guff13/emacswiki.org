The standard library tooltip.el provides the function for displaying a tooltip at mouse position which allows users to easily show it. However, locating tooltip at arbitrary buffer position in window is not easy. This program provides such function to be used by other frontend programs.

Note that this program can work only under X window system.

== Downloading ==

: Lisp:pos-tip.el

== Installation ==

To use pos-tip.el, save this file in a directory listed in load-path together with the programs which use this library.

== Sample program 1: Describe function in tooltip ==

=== Code ===

 (require 'pos-tip)

 (defun my-describe-function (function)
   "Display the full documentation of FUNCTION (a symbol) in tooltip."
   (interactive (list (function-called-at-point)))
   (if (null function)
       (pos-tip-show
        "** You didn't specify a function! **" '("red"))
     (pos-tip-show
      (with-temp-buffer
        (let ((standard-output (current-buffer)))
          (prin1 function)
          (princ " is ")
          (describe-function-1 function)
          (buffer-string)))
      nil nil nil 0)))

 (define-key emacs-lisp-mode-map (kbd "C-;") 'my-describe-function)

=== Screenshot ===

[[image:PosTipScreenshotDescFun]]

== Sample program 2: sdic-inline-pos-tip.el ==

This program provides the tooltip showing word meanings at cursor position like `[https://addons.mozilla.org/en-US/firefox/addon/2471?from=%2Fja%2Ffirefox%2Faddon%2F2471 rikaichan]' Firefox extension, using Lisp:sdic-inline.el which was written by [[khiker]].

=== Downloading ===

: Lisp:sdic-inline-pos-tip.el

=== Screenshot ===

[[image:PosTipScreenshot]]

=== Setting ===

 (require 'sdic-inline-pos-tip)

 ;; *Change the following lines according to your environment*
 (setq sdic-inline-eiwa-dictionary "/usr/share/dict/gene.sdic")
 (setq sdic-inline-waei-dictionary "/usr/share/dict/jedict.sdic")

 ;; The following is optional. Uncomment if necessary.
 ;; (mapc (lambda (mode)
 ;;         (add-to-list 'sdic-inline-enable-modes mode))
 ;;       '(help-mode Info-mode))
 ;; (mapc (lambda (face)
 ;;         (add-to-list 'sdic-inline-enable-faces face))
 ;;       '(font-lock-doc-face))

 (setq sdic-inline-search-func 'sdic-inline-search-word-with-stem)
 (setq sdic-inline-display-func 'sdic-inline-pos-tip-show)

 (define-key sdic-inline-map "\C-c\C-p" 'sdic-inline-pos-tip-show)

 (sdic-inline-mode 1)




== Discussion ==

[new:DrewAdams:2010-03-09 16:19 UTC]
Some unsolicited feedback. ;-)

* Doesn't work for me. This is what I have in buffer ##*xwininfo*##, after the `call-process': ##/usr/bin/bash: xwininfo: command not found##. I'm using Cygwin (and Windows). Please state in the file's Commentary what the prerequisites are (and which Emacs versions are supported).

* Just out of curiosity, why not just add some optional parameters ##left## and ##top## to `tooltip-show' (calling it, e.g. `my-tooltip-show'), and then add this to the body:

        (when left (setq params  (tooltip-set-param params 'left left)))
        (when top  (setq params  (tooltip-set-param params 'top top)))

: That's simple and seems to work. And you could also convert between window/buffer position and pixels, if you like.

I agree that it is too bad that there is no simple way to show a tooltip at a specified position. The code should not be tightly coupled to a mouse position, as it is currently. Perhaps you can suggest a change to the Emacs developers, to allow passing the display position explicitly. -- DrewAdams

[new]
: I think your solution for `tooltip-show' is insufficient because tooltip immediately vanishes if it overlaps with mouse pointer. `pos-tip-show' can move out mouse pointer. -- [[irie]]

[new:DrewAdams:2010-03-11 07:57 UTC]
:: There is apparently an Emacs 23 bug -- I just filed a report (#5703). It works fine in Emacs 22, but Emacs 23 ignores the specified `left' and `top' locations, contradicting the doc strings of both `tooltip-show' and `tooltip-frame-parameters'. In Emacs 23, it always uses the mouse [[pointer]] location, which is wrong. -- DrewAdams

[new]
::: Hmm... I can't reproduce such bug.
::: Anyway, Emacs should provide functions which return absolute coordinates of buffer position or window origin. Otherwise the `left' and `top' properties of tooltip are useless in non-X environments. -- [[irie]]

[new:DrewAdams:2010-03-12 14:50 UTC]
:::: It's probably a Windows-specific bug.
:::: ##(frame-parameters)## in a console (i.e. non-graphic) frame does not have `left' and `top' to let you know where it is or let you position it. I suppose there's no way to let you (Emacs) control this.
:::: Function `window-edges' will give you the location of a window wrt its frame, and `frame-parameters' will give you the location of the frame (except for a console frame). -- DrewAdams

[new]
::::: Of course I've known them. To calculate absolute coordinates under X window system, users must also obtain the pixel height of menu-bar and tool-bar and the pixel width of frame extents, because `window-edges' returns the location of window relative to a X window corresponding to `window-id', but `frame-parameter' returns the location of a X window corresponding to `outer-window-id' or `parent-id'. That is, these two functions regard the different X windows as `frame'. Unfortunately, there is no way to obtain the tool-bar height etc. without calling external programs like ##xwininfo##. -- [[irie]]

[new:DrewAdams:2010-03-12 17:32 UTC]
:::::: Agreed. Consider filing a bug (enhancement request): ##M-x report-emacs-bug## -- DrewAdams

----
[new]
There is a simple function point-to-coord in ourcomments-util.el in [NxhtmlMode nXhtml] that I have suggested adding to Emacs (without success yet) which I have been using for poping up a menu at point. Maybe this can be merged with pos-tip-compute-pixel-position here?
-- LennartBorgman

[new]
: It seems that `point-to-coord' returns the pixel position relative to top left corner of *frame*, but tooltip must be specified it relative to top left corner of *display* because tooltip itself is a small frame. -- [[irie]]

[new]
Yes, but shouldn't it be easy to translate to that format? -- LennartBorgman

----
[new]
Since ##pos-tip.el## uses UTF-8, the first line should read

    pos-tip.el -- Show tooltip at point -*- coding: utf-8 -*-

-- VegardOye

[new]
: Thanks. I modified. -- [[irie]]


