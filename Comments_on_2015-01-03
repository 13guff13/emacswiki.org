''Great news!'' Thanks for all the work, Alex & Nic.

I still cannot get to the Elisp files, however. I go to ElispArea, click the `Downloading' link in the TOC, then the link `Alphabetical list of all Elisp libraries on this Wiki' (URL: http://www.emacswiki.org/emacs?action=elisp-area;context=0), and I just get (eventually): 

  504 Gateway Time-out

  nginx/1.4.6 (Ubuntu)

Am I not doing something I should? I closed all browser windows and cleared the browser cache as well. I'm using Google Chrome at the moment.

Thx -- DrewAdams

-- DrewAdams 2015-01-04 00:27 UTC


----

Right. We'll get to it.

-- [http://emacswiki.org/wiki/NicFerrier NicFerrier] 2015-01-04 00:32 UTC


----

Thanks; I wasn't sure if I was missing something.

-- DrewAdams 2015-01-04 01:21 UTC


----

FYI, just in case you are not aware of it: 

At least some Elisp pages do not appear as code but as if they were HTML. E.g., http://www.emacswiki.org/emacs/palette.el.

Some other libraries show the same problem, but some appear OK. Not sure what the difference is.

HTH.

-- DrewAdams 2015-01-04 03:12 UTC


----

Hm, I have no idea why these files "lost" their formatting. When I edited the file and hit the Preview button, it looked OK, so all I did was edit the file and append a newline. Now it's back to normal. Weird.

-- AlexSchroeder 2015-01-04 09:57 UTC


----

I see. Thanks for taking a look. There are other files with the same problem. I tried to fix `bookmark+-1.el' the same way, for instance, but I got `504 Gateway Time-out' when I tried to save it. I guess I'll just need to wait a bit for this.

-- DrewAdams 2015-01-04 20:56 UTC


----

FYI - I was able to fix `bookmark+-1.el', by trying again. I guess it must be borderline wrt the timeout.

-- DrewAdams 2015-01-04 20:59 UTC


----

Hm, we should keep an eye on 504 errors just in case that's an issue between the caching proxy (nginx) and the web server (apache).

-- AlexSchroeder 2015-01-04 21:17 UTC


----

FWIW, I see it (504) pretty consistently with the larger files. E.g., I cannot update bookmark+-1.el now - clicking Edit just times out.

-- DrewAdams 2015-01-04 21:20 UTC


----

The problem is with the url that nginx is sending to Apache or Perl. 

If I do this on the server: http://internal-apache/emacs/bookmark%2b-1.el - it fails

So is this the correct url? If so why is apache/perl failing?

-- [http://emacswiki.org/wiki/NicFerrier NicFerrier] 2015-01-04 21:59 UTC


----

Looks like the correct URL to me. There are no errors in the Apache log. It just hangs... Weird!
The %2b is not the issue. This URL works, for example: http://www.emacswiki.org/emacs/find-func%2b.el

-- AlexSchroeder 2015-01-04 22:05 UTC


----

it's incredibly slow though. Is that expected? is that just render time for the font-lock for such a large file?

-- [http://emacswiki.org/wiki/NicFerrier NicFerrier] 2015-01-04 22:09 UTC


----

Once it gets cached it's fine. If you're not using caching though (because you're an editor) you're going to be pounding the server.

-- [http://emacswiki.org/wiki/NicFerrier NicFerrier] 2015-01-04 22:10 UTC


----

It's the same thing with the other largish files, e.g. icicles-chg.el. Note too that at least once I was able to get past the timeout for bookmark+-1.el for both Edit and Save. But only once.

-- DrewAdams 2015-01-04 22:26 UTC


----

Also, FYI, I get 404 Not Found errors for pages such as http://emacswiki.org/Icicles.  (Dunno whether that is to be expected at this point.)

-- DrewAdams 2015-01-04 22:32 UTC


----

Wtf is that? surely everything is namespaced?

-- [http://emacswiki.org/wiki/NicFerrier NicFerrier] 2015-01-04 22:38 UTC


----

@Nic: I don't understand your question.

FYI, that is not an Elisp-file page. It is an ordinary (doc) wiki page. Same thing for other such pages, e.g., http://emacswiki.org/BookmarkPlus.

-- DrewAdams 2015-01-04 22:43 UTC


----

FYI - I just tried 3 times to save icicles-cmd2.el (another fairly large file). After two attempts with 504's, I was able to save it.

-- DrewAdams 2015-01-04 22:44 UTC


----

Are they supposed to work? My understanding is that everything is namespaced by /emacs/ (/wiki/ is a redirect to /emacs/).

So http://emacswiki.org/WikiPageName will not work but http://emacswiki.org/emacs/WikiPageName will

You are suggesting that my understanding is incorrect?

If so, I don't see many 404s matching what you're suggesting.

-- [http://emacswiki.org/wiki/NicFerrier NicFerrier] 2015-01-04 22:45 UTC


----

They all worked previously. I have such URLs in the headers of '''all''' of my Elisp files, and they have also been referenced as such over the Web (e.g. StackOverflow) as cross-references. 

Here is a typical part of an Elisp file header, which refers to such a URL:

    ;; URL: http://www.emacswiki.org/icicles-face.el
    ;; Doc URL: http://www.emacswiki.org/Icicles

Not only that, but such URLs are used in the code itself, to consult the doc on the web (the wiki).

My understanding was that only the /cgi-bin/wiki parts of URLs (e.g. people's bookmarks, such as http://www.emacswiki.org/cgi-bin/wiki/BookmarkPlus) would no longer work, so that people would need to update their bookmarks.

-- DrewAdams 2015-01-04 22:51 UTC


----

Update:

I was able to upload most of my Elisp files, but not these (consistent timeouts): bookmark+-1.el, icicles-cmd1.el, icicles-chg.el. (Icicles & Bookmark+ are currently broken for download by users, without those first two files.)

Some of the ones I was able to upload took 3 or 4 attempts (504s, but eventually success).

Still cannot access files using http://www.emacswiki.org/*.

Thx.

-- DrewAdams 2015-01-05 01:19 UTC


----

Hm, yes, perhaps there was a rewrite rule that got lost in the migration. I'll take a look... OK, right now the problem is that the cache doesn't realize that these requests can be handed to the back-end.

-- AlexSchroeder 2015-01-05 06:39 UTC


----

As for bookmark+-1.el: I found the code painfully slow even without colorization (##http://www.emacswiki.org/emacs/raw/bookmark%2b-1.el##). Some investigation led me to the data file parser. Looking at the revision history, I found the following entry from Oct 2006:

    (ParseData): Hand-written to optimize for speed. By getting rid of
    some regular expressions used for parsing, the code is now more
    than 10x faster. This is important for default searching, and for
    indexed search using double-quotes.

Reverting to the old, regular expression based code fixes [[bookmark+-1.el]]?
I'm not sure why this is so. Perhaps the newer Perl versions are better at some regular expressions.
In addition to that, the wiki no longer does searching (nor indexed search) â€“ we're letting Duck Duck Go handle that,
so the drawbacks from 2006 don't affect us whether they're true or not.

So, problem fixed?

-- AlexSchroeder 2015-01-05 07:34 UTC

