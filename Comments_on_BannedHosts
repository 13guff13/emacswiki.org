Leave a comment if you want to join the EmacsWikiAdministrators team or if you feel that entries from BannedHosts should be removed.

-- AlexSchroeder 2012-10-03 19:11 UTC


----

I've been thinking about banning certain user agents. Bad idea?
I just checked today's access.log file and compared it with the banned IP numbers.
Here are two candidates, for example:

{{{
Opera/9.80 (Windows NT 5.1; U; ru) Presto/2.9.168 Version/11.50
Mozilla/5.0 (Windows NT 6.1; rv:9.0.1) Gecko/20100101 Firefox/9.0.1
}}}

Another option would be to detect IP numbers that are quickly changing their user agent.
Here's a typical session where the agent gets the edit page and the posts.
The first thing I notice is that out anti-spam measures defeated three out of four attempts at posting (the 403 reponse to the POST means "access denied").

The other thing I notice is that after the 403 response, the pattern repeats but *the user agent changes*.
Is this worth exploiting? If an agent runs afoul of our spam measures and repeats the GET and POST request using a different agent, add the IP number to BannedHosts automatically. I'm not so sure about this one.

Another thing that seems worth noting is that in this particular case, we could have guessed that the IP number is up to no good after three failed attempts at editing the page. Perhaps this is worth exploiting in a form of "three strikes" â€“ if an agent runs afoul of our existing anti-spam measures three times in a certain time window, add the IP number to BannedHosts automatically. This seems much more plausible.

{{{
137.175.68.182 "GET /emacs/?action=edit;id=SiteMap_Discussion HTTP/1.0" 200 "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.835.163 Safari/535.1"
137.175.68.182 "POST /cgi-bin/emacs HTTP/1.0" 403 "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.835.163 Safari/535.1"
137.175.68.182 "GET /emacs/?action=edit;id=SiteMap_Discussion HTTP/1.0" 200 "Mozilla/5.0 (Windows NT 5.2; rv:12.0) Gecko/20100101 Firefox/12.0"
137.175.68.182 "POST /cgi-bin/emacs HTTP/1.0" 403 "Mozilla/5.0 (Windows NT 5.2; rv:12.0) Gecko/20100101 Firefox/12.0"
137.175.68.182 "GET /emacs/?action=edit;id=SiteMap_Discussion HTTP/1.0" 200 "Opera/9.80 (Windows NT 5.1; MRA 6.0 (build 5998)) Presto/2.12.388 Version/12.11"
137.175.68.182 "POST /cgi-bin/emacs HTTP/1.0" 403 "Opera/9.80 (Windows NT 5.1; MRA 6.0 (build 5998)) Presto/2.12.388 Version/12.11"
137.175.68.182 "GET /emacs/?action=edit;id=SiteMap_Discussion HTTP/1.0" 200 "Opera/9.80 (Windows NT 5.1; U; ru) Presto/2.9.168 Version/11.50"
137.175.68.182 "POST /cgi-bin/emacs HTTP/1.0" 302 "Opera/9.80 (Windows NT 5.1; U; ru) Presto/2.9.168 Version/11.50"
137.175.68.182 "GET /emacs/SiteMap_Discussion HTTP/1.0" 200 "Opera/9.80 (Windows NT 5.1; U; ru) Presto/2.9.168 Version/11.50"
}}}

Another idea I've had based on the log file (not visible in the extract above) is that very little time elapses between GET and POST:

{{{
137.175.68.182 - - [15/Aug/2013:15:39:10 +0200] "GET /emacs/?action=edit;id=SiteMap_Discussion HTTP/1.0"
137.175.68.182 - - [15/Aug/2013:15:39:16 +0200] "POST /cgi-bin/emacs HTTP/1.0"
137.175.68.182 - - [15/Aug/2013:15:41:41 +0200] "GET /emacs/?action=edit;id=SiteMap_Discussion HTTP/1.0"
137.175.68.182 - - [15/Aug/2013:15:41:51 +0200] "POST /cgi-bin/emacs HTTP/1.0"
137.175.68.182 - - [15/Aug/2013:20:32:57 +0200] "GET /emacs/?action=edit;id=SiteMap_Discussion HTTP/1.0"
137.175.68.182 - - [15/Aug/2013:20:33:04 +0200] "POST /cgi-bin/emacs HTTP/1.0"
137.175.68.182 - - [15/Aug/2013:20:34:53 +0200] "GET /emacs/?action=edit;id=SiteMap_Discussion HTTP/1.0"
137.175.68.182 - - [15/Aug/2013:20:34:58 +0200] "POST /cgi-bin/emacs HTTP/1.0"
137.175.68.182 - - [15/Aug/2013:20:35:01 +0200] "GET /emacs/SiteMap_Discussion HTTP/1.0"
}}}

This looks more promising. I'll give it a try.

-- AlexSchroeder 2013-08-15 21:10 UTC

